---
title: "Area relationships"
output: html_document
date: "2023-07-07"
---
#Housekeeping
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(tidyverse)
library(stringr)
library(tidyr)
library(readr)
library(scales) #to force scientific notation in some figures
library(ggtext)
library(gridExtra)
library(patchwork)

theme_set(theme_classic())
# 
# save(A_relation, Ainun_1stO, Ainun_2ndO, Ainun_3rdO, Ainun_4thO,
     # file = "C:/Users/morganao/Documents/CBT_Oehler2023/9_Saved_Dataframes/A_relation.RData")
# save( Ainun_1stO, Ainun_2ndO, Ainun_3rdO, Ainun_4thO,
# file = "C:/Users/morganao/Documents/CBT_Oehler2023/9_Saved_Dataframes/A&trelation.RData")
```

#Area vs Time
```{r plot-wider, fig.width=16, fig.height=4}
AvsT <- bind_rows(Ainun_1stO, Ainun_2ndO, Ainun_3rdO, Ainun_4thO)%>%
  mutate(restLoc = 
           case_when(startsWith(plan, "unr") ~ "unr",
                     startsWith(plan, "1st") ~ "1st",
                     startsWith(plan, "2nd") ~ "2nd",
                     startsWith(plan, "3rd") ~ "3rd",
                     startsWith(plan, "4th") ~ "4th"))%>%
  mutate(order = 
           case_when(river == "1-7" ~ "1st-order rivers",
                     river == "2-2" ~ "2nd-order rivers",
                     river == "3-1" ~ "3rd-order rivers",
                     river == "4-1" ~ "4th-order river"))


AvsT%>%
  # filter(order == "2nd-order")%>%
  ggplot()+
  geom_point(aes(scale_inun_A, inun_t_avg, color = storm))+
  facet_wrap( ~order, scales = "free", ncol = 4)+
  labs(color = "Storm", shape = "Inundation Location")+
  xlab(expression(atop("Inundated Floodplain Area (x10"^5*" m"^2*")")))+
  ylab("Average Areal Inundation time (hrs)")+
  ggtitle(expression("Inundated Area vs Time (k"[m]*" rate)"))

ggsave("Figures/timeVSarea.png", width = 16, height = 4, units="in")

```



#I dont think I ended up using this. Unr and Restored areas by plan DF
```{r}
# NO3_4thO <- NO3_4thO[!NO3_4thO$plan == "unr", ]

#Creating a data table with an un-restored and restored area associated with every XS and river for every plan. This is not related to the area that is inundated.
A_relation <- bind_rows(NO3_1stO, NO3_2ndO, NO3_3rdO, NO3_4thO) %>%
  # group_by(storm, plan, FP_width, river) %>%
  # summarise(k10_removal_g = sum(k10_removal_g),
  #           km_removal_g = sum(km_removal_g),
  #           k90_removal_g = sum(k90_removal_g))%>%
  mutate(unr_rest =
           case_when(FP_width == 16.5 ~ "unrestored",
                     FP_width == 60 ~ "restored",
                     FP_width == 34.5 ~ "unrestored",
                     FP_width == 65 ~ "restored",
                     FP_width == 67.5 ~ "unrestored",
                     FP_width == 75 ~ "restored",
                     FP_width == 126 ~ "unrestored",
                     FP_width == 130 ~ "restored"
                     ))%>%
  mutate(XS_A_ft2 =
           case_when(FP_width == 16.5 ~ 1650,
                     FP_width == 60 ~ 6000,
                     FP_width == 34.5 ~ 3450,
                     FP_width == 65 ~ 6500,
                     FP_width == 67.5 ~ 6750,
                     FP_width == 75 ~ 7500,
                     FP_width == 126 ~ 126000,
                     FP_width == 130 ~ 13000
                     ))%>%
  mutate(No_XS = 
           case_when(plan == "unr" & river == "1-7" ~ 120,
                     plan == "unr" & river == "2-2" ~ 330,
                     plan == "unr" & river == "3-1" ~ 840,
                     plan == "unr" & river == "4-1" ~ 2020,
                     endsWith(plan, "100p") & river == "1-7" ~ 120,
                     endsWith(plan, "100p") & river == "2-2" ~ 330,
                     endsWith(plan, "100p") & river == "3-1" ~ 840,
                     endsWith(plan, "100p") & river == "4-1" ~ 2020,
                     
                     plan == "1st-20p" & FP_width == 16.5 ~ 96,
                     plan == "1st-20p" & FP_width == 60 ~ 24,
                     plan == "1st-40p" & FP_width == 16.5 ~ 72,
                     plan == "1st-40p" & FP_width == 60 ~ 48,
                     plan == "1st-60p" & FP_width == 16.5 ~ 48,
                     plan == "1st-60p" & FP_width == 60 ~ 72,
                     plan == "1st-80p" & FP_width == 16.5 ~ 24,
                     plan == "1st-80p" & FP_width == 60 ~ 96,
                     startsWith(plan, "1st") & river == "2-2" ~ 330,
                     startsWith(plan, "1st") & river == "3-1" ~ 840,
                     startsWith(plan, "1st") & river == "4-1" ~ 2020,
                       
                     plan == "2nd-20p" & FP_width == 34.5 ~ 264,
                     plan == "2nd-20p" & FP_width == 65 ~ 66,
                     plan == "2nd-60p" & FP_width == 34.5 ~ 132,
                     plan == "2nd-60p" & FP_width == 65 ~ 198,
                     plan == "2nd-80p" & FP_width == 34.5 ~ 66,
                     plan == "2nd-80p" & FP_width == 65 ~ 264,
                     startsWith(plan, "2nd") & river == "1-7" ~ 120,
                     startsWith(plan, "2nd") & river == "3-1" ~ 840,
                     startsWith(plan, "2nd") & river == "4-1" ~ 2020,
                     
                     plan == "3rd-20p" & FP_width == 67.5 ~ 264,
                     plan == "3rd-20p" & FP_width == 75 ~ 66,
                     plan == "3rd-40p" & FP_width == 67.5 ~ 264,
                     plan == "3rd-40p" & FP_width == 75 ~ 66,
                     plan == "3rd-60p" & FP_width == 67.5 ~ 132,
                     plan == "3rd-60p" & FP_width == 75 ~ 198,
                     plan == "3rd-80p" & FP_width == 67.5 ~ 66,
                     plan == "3rd-80p" & FP_width == 75 ~ 264,
                     startsWith(plan, "3rd") & river == "1-7" ~ 120,
                     startsWith(plan, "3rd") & river == "2-2" ~ 330,
                     startsWith(plan, "3rd") & river == "4-1" ~ 2020,
                     
                     plan == "4th-20p" & FP_width == 126 ~ 1616,
                     plan == "4th-20p" & FP_width == 130 ~ 404,
                     plan == "4th-40p" & FP_width == 126 ~ 1212,
                     plan == "4th-40p" & FP_width == 130 ~ 808,
                     plan == "4th-60p" & FP_width == 126 ~ 808,
                     plan == "4th-60p" & FP_width == 130 ~ 1212,
                     plan == "4th-80p" & FP_width == 126 ~ 404,
                     plan == "4th-80p" & FP_width == 130 ~ 1616,
                     startsWith(plan, "4th") & river == "1-7" ~ 120,
                     startsWith(plan, "4th") & river == "2-2" ~ 330,
                     startsWith(plan, "4th") & river == "3-1" ~ 840)) %>%
  mutate(km_avgXSremoval = km_removal_g/No_XS) %>%
  mutate(percentRest = case_when(endsWith(plan, "100p")~ 100, #for plotting
                                 endsWith(plan, "80p")~ 80,
                                 endsWith(plan, "60p")~ 60,
                                 endsWith(plan, "40p")~ 40,
                                 endsWith(plan, "20p")~ 20,
                                 endsWith(plan, "unr")~ 0))

A_relation$storm <- factor(A_relation$storm,                 # Re-level group factor
                         levels = c("Q2", "Q1", "Q0.5", "Qm"))
A_relation$river <- factor(A_relation$river,                 # Re-level group factor
                         levels = c("1-7", "2-2", "3-1", "4-1"))
filter <- A_relation
```

#THESE PLOTS ARE WRONG. Average loads removed between unr and restored XS
```{r}
#Average XS removal for km rate (idk if this is really meaningful so I did totals below). Realizing this is not even a true average because I should have divided by the number of un-restored or restored XS that were inundated within the reach. I don't think this is worth the time going back to figure out how to separate this.
filter%>% 
  filter(river == "1-7") %>%
  filter(plan == "unr"| plan =="1st-20p"|plan =="1st-40p"| plan =="1st-60p"| plan =="1st-80p"| plan =="1st-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  geom_line(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 1-7 Restored")+
  ylab("Average NO3 Removed (g)")+
  ggtitle("Average NO3 Load Removed at a Single Unrestored vs Restored \n 1st-order XS (km rate)")

filter%>% 
  filter(river == "2-2") %>%
  filter(plan == "unr"| plan =="2nd-20p"| plan =="2nd-60p"| plan =="2nd-80p"| plan =="2nd-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  geom_line(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 2-2 Restored")+
  ylab("Average NO3 Removed (g)")+
  ggtitle("Average NO3 Load Removed at a Single Unrestored vs Restored \n 2nd-order XS (km rate)")

filter%>% 
  filter(river == "3-1") %>%
  filter(plan == "unr"| plan =="3rd-20p"|plan =="3rd-40p"| plan =="3rd-60p"| plan =="3rd-80p"| plan =="3rd-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  geom_line(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 3-1 Restored")+
  ylab("Average NO3 Removed (g)")+
  ggtitle("Average NO3 Load Removed at a Single Unrestored vs Restored \n 3rd-order XS (km rate)")

filter%>% 
  filter(river == "4-1") %>%
  filter(plan == "unr"| plan =="4th-20p"|plan =="4th-40p"| plan =="4th-60p"| plan =="4th-80p"| plan =="4th-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  geom_line(aes(percentRest, km_avgXSremoval, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 4-1 Restored")+
  ylab("Average NO3 Removed (g)")+
  ggtitle("Average NO3 Load Removed at a Single Unrestored vs Restored \n 4th-order XS (km rate)")
```

#I dont think I ended up using this. Total loads removed from unr vs restored river floodplains of a single river (not scaled to watershed).
```{r}
#Load removal in un-restored vs restored areas
filter%>% 
  filter(river == "1-7") %>%
  filter(plan == "unr"| plan =="1st-20p"|plan =="1st-40p"| plan =="1st-60p"| plan =="1st-80p"| plan =="1st-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_removal_g, color = unr_rest))+
  geom_line(aes(percentRest, km_removal_g, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 1-7 Restored")+
  ylab("Load (g)")+
  ggtitle("Total NO3 Load Removed from Unrestored vs Restored Areas \n in River 1-7 (g) (km rate)")
ggsave("Exports/unrVSrest_load17_km.png", units="in")

filter%>% 
  filter(river == "2-2") %>%
  filter(plan == "unr"| plan =="2nd-20p"| plan =="2nd-60p"| plan =="2nd-80p"| plan =="2nd-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_removal_g, color = unr_rest))+
  geom_line(aes(percentRest, km_removal_g, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 2-2 Restored")+
  ylab("Load (g)")+
  ggtitle("Total NO3 Load Removed from Unrestored vs Restored Areas \n in River 2-2 (g) (km rate)")
ggsave("Exports/unrVSrest_load22_km.png", units="in")

filter%>% 
  filter(river == "3-1") %>%
  filter(plan == "unr"| plan =="3rd-20p"|plan =="3rd-40p"| plan =="3rd-60p"| plan =="3rd-80p"| plan =="3rd-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_removal_g, color = unr_rest))+
  geom_line(aes(percentRest, km_removal_g, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 3-1 Restored")+
  ylab("Load (g)")+
  ggtitle("Total NO3 Load Removed from Unrestored vs Restored Areas \n in River 3-1 (g) (km rate)")
ggsave("Exports/unrVSrest_load31_km.png", units="in")

filter%>% 
  filter(river == "4-1") %>%
  filter(plan == "unr"| plan =="4th-20p"|plan =="4th-40p"| plan =="4th-60p"| plan =="4th-80p"| plan =="4th-100p")%>%
  ggplot()+
  geom_point(aes(percentRest, km_removal_g, color = unr_rest))+
  geom_line(aes(percentRest, km_removal_g, color = unr_rest))+
  facet_wrap(~storm, scales = "free", ncol = 2)+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  xlab("% of River 4-1 Restored")+
  ylab("Load (g)")+
  ggtitle("Total NO3 Load Removed from Unrestored vs Restored Areas \n in River 4-1 (g) (km rate)")
ggsave("Exports/unrVSrest_load41_km.png", units="in")

```

#Area calcs DF
```{r}
#Dataframes with the total inundated area and associated removal load over the simulation in each order due to single order restoration.
Ainun_1stO <- inun_1stO %>%
  filter(ti_tot_min > 0)%>%
  mutate( #Calculating area
    FP_width =
           case_when(
             plan == "unr" & river == "1-7" ~ 16.5,
             plan == "1st-20p" & river == "1-7" & STA >= 164300 ~ 60,
             plan == "1st-20p" & river == "1-7" & STA < 164300 ~ 16.5,
             plan == "1st-40p" & river == "1-7" & STA >= 163100 ~ 60,
             plan == "1st-40p" & river == "1-7" & STA < 163100 ~ 16.5,
             plan == "1st-60p" & river == "1-7" & STA >= 161900 ~ 60,
             plan == "1st-60p" & river == "1-7" & STA < 161900 ~ 16.5,
             plan == "1st-80p" & river == "1-7" & STA >= 160700 ~ 60,
             plan == "1st-80p" & river == "1-7" & STA < 160700 ~ 16.5,
             plan == "1st-100p" & river == "1-7" ~ 60,
             river == "2-2" ~ 34.5,
             river == "3-1" ~ 67.5,
             river == "4-1" ~ 126),
   length_ft =
           case_when(ti_tot_min > 1 ~ 50),
   area_ft2 = FP_width*length_ft) %>%
  # mutate(
  #   k10_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                   ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "4-1" & (STA < 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000)) %>%
   mutate(
    km_removal_g =
      case_when(river == "1-7" & STA %in% c(165500,159500)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "1-7" & STA < 165500 & STA > 159500
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "2-2" & (STA < 159500 & STA > 154000) |
                                 (STA < 154000 & STA > 148500) |
                                 (STA < 148500 & STA > 143000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "3-1" & STA %in% c(143000, 122000, 101000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "3-1" & (STA < 143000 & STA > 122000) |
                                 (STA < 122000 & STA > 101000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "4-1" & STA %in% c(101000, 0)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "4-1" & (STA < 101000 & STA > 0)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000)) %>%
  # mutate(
  #   k90_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "4-1" & (STA < 101000 & STA > 0)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000)) %>%
    group_by(storm, plan, river) %>%
    summarise(#removal_k10_g = sum(k10_removal_g),
            removal_km_g = sum(km_removal_g),
            #removal_k90_g = sum(k90_removal_g),
            inun_A = sum(area_ft2, na.rm = TRUE),
            inun_t_avg = mean(ti_tot_min))%>% #Made change here and all commented out areas.
  mutate(percentRest = case_when(endsWith(plan, "100p")~ 100,
                                 endsWith(plan, "80p")~ 80,
                                 endsWith(plan, "60p")~ 60,
                                 endsWith(plan, "40p")~ 40,
                                 endsWith(plan, "20p")~ 20,
                                 endsWith(plan, "unr")~ 0))
Ainun_1stO <- Ainun_1stO%>%
  mutate(inun_t_avg =inun_t_avg/60,
    scale_inun_A = #I scale loads and areas to the watershed here
           case_when(river == "1-7" ~ inun_A*24*0.092903/100000,
                     river == "2-2" ~ inun_A*6*0.092903/100000,
                     river == "3-1" ~ inun_A*2*0.092903/100000,
                     river == "4-1" ~ inun_A*0.092903/100000),
         scaleRemoval_km_kg = 
           case_when(river == "1-7" ~ removal_km_g*24/1000,
                     river == "2-2" ~ removal_km_g*6/1000,
                     river == "3-1" ~ removal_km_g*2/1000,
                     river == "4-1" ~ removal_km_g/1000),
         order = 
           case_when(river == "1-7" ~ "1st-order",
                     river == "2-2" ~ "2nd-order",
                     river == "3-1" ~ "3rd-order",
                     river == "4-1" ~ "4th-order")) 

Ainun_2ndO <- inun_2ndO %>%
  filter(ti_tot_min > 0)%>%
  mutate(
    FP_width =
           case_when(
             river == "1-7" ~ 16.5,
             plan == "unr" & river == "2-2" ~ 34.5,
             plan == "2nd-20p" & river == "2-2" & STA >= 156200 ~ 65,
             plan == "2nd-20p" & river == "2-2" & STA < 156200 ~ 34.5,
             # plan == "2nd-40p" & river == "2-2" & STA >= 152900 ~ 65,
             # plan == "2nd-40p" & river == "2-2" & STA < 152900 ~ 34.5,
             plan == "2nd-60p" & river == "2-2" & STA >= 149600 ~ 65,
             plan == "2nd-60p" & river == "2-2" & STA < 149600 ~ 34.5,
             plan == "2nd-80p" & river == "2-2" & STA >= 146300 ~ 65,
             plan == "2nd-80p" & river == "2-2" & STA < 146300 ~ 34.5,
             plan == "2nd-100p" & river == "2-2" ~ 65,
             river == "3-1" ~ 67.5,
             river == "4-1" ~ 126),
    length_ft =
           case_when(ti_tot_min > 1 ~ 50),
    area_ft2 = FP_width*length_ft) %>%
  # mutate(
  #   k10_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                   ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "4-1" & (STA < 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000)) %>%
   mutate(
    km_removal_g =
      case_when(river == "1-7" & STA %in% c(165500,159500)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "1-7" & STA < 165500 & STA > 159500
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "2-2" & (STA < 159500 & STA > 154000) |
                                 (STA < 154000 & STA > 148500) |
                                 (STA < 148500 & STA > 143000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "3-1" & STA %in% c(143000, 122000, 101000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "3-1" & (STA < 143000 & STA > 122000) |
                                 (STA < 122000 & STA > 101000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "4-1" & STA %in% c(101000, 0)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "4-1" & (STA < 101000 & STA > 0)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000)) %>%
  # mutate(
  #   k90_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "4-1" & (STA < 101000 & STA > 0)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000)) %>%
    group_by(storm, plan, river) %>%
    summarise(inun_t_avg = mean(ti_tot_min)/60,
      #removal_k10_g = sum(k10_removal_g),
            removal_km_g = sum(km_removal_g),
            #removal_k90_g = sum(k90_removal_g),
            inun_A = sum(area_ft2, na.rm = TRUE))%>%
  mutate(percentRest = case_when(endsWith(plan, "100p")~ 100,
                                 endsWith(plan, "80p")~ 80,
                                 endsWith(plan, "60p")~ 60,
                                 endsWith(plan, "40p")~ 40,
                                 endsWith(plan, "20p")~ 20,
                                 endsWith(plan, "unr")~ 0))
Ainun_2ndO <- Ainun_2ndO %>%
  mutate(scale_inun_A =
           case_when(river == "1-7" ~ inun_A*24*0.092903/100000,#I scale loads and areas to the watershed here
                     river == "2-2" ~ inun_A*6*0.092903/100000,
                     river == "3-1" ~ inun_A*2*0.092903/100000,
                     river == "4-1" ~ inun_A*0.092903/100000),
         scaleRemoval_km_kg =
           case_when(river == "1-7" ~ removal_km_g*24/1000,
                     river == "2-2" ~ removal_km_g*6/1000,
                     river == "3-1" ~ removal_km_g*2/1000,
                     river == "4-1" ~ removal_km_g/1000),
         order =
           case_when(river == "1-7" ~ "1st-order",
                     river == "2-2" ~ "2nd-order",
                     river == "3-1" ~ "3rd-order",
                     river == "4-1" ~ "4th-order"))

Ainun_3rdO <- inun_3rdO %>%
  filter(ti_tot_min > 0)%>%
  mutate(
    FP_width =
           case_when(
             river == "1-7" ~ 16.5,
             river == "2-2" ~ 34.5,
             plan == "unr" & river == "3-1" ~ 67.5,
             plan == "3rd-20p" & river == "3-1" & STA >= 134600 ~ 75,
             plan == "3rd-20p" & river == "3-1" & STA < 134600 ~ 67.5,
             plan == "3rd-40p" & river == "3-1" & STA >= 126200 ~ 75,
             plan == "3rd-40p" & river == "3-1" & STA < 126200 ~ 67.5,
             plan == "3rd-60p" & river == "3-1" & STA >= 117800 ~ 75,
             plan == "3rd-60p" & river == "3-1" & STA < 117800 ~ 67.5,
             plan == "3rd-80p" & river == "3-1" & STA >= 109400 ~ 75,
             plan == "3rd-80p" & river == "3-1" & STA < 109400 ~ 67.5,
             plan == "3rd-100p" & river == "3-1" ~ 75,
             river == "4-1" ~ 126),
    length_ft =
           case_when(ti_tot_min > 1 ~ 50),
    area_ft2 = FP_width*length_ft) %>%
  # mutate(
  #   k10_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                   ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "4-1" & (STA < 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000)) %>%
   mutate(
    km_removal_g =
      case_when(river == "1-7" & STA %in% c(165500,159500)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "1-7" & STA < 165500 & STA > 159500
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "2-2" & (STA < 159500 & STA > 154000) |
                                 (STA < 154000 & STA > 148500) |
                                 (STA < 148500 & STA > 143000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "3-1" & STA %in% c(143000, 122000, 101000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "3-1" & (STA < 143000 & STA > 122000) |
                                 (STA < 122000 & STA > 101000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "4-1" & STA %in% c(101000, 0)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "4-1" & (STA < 101000 & STA > 0)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000)) %>%
  # mutate(
  #   k90_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "4-1" & (STA < 101000 & STA > 0)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000)) %>%
    group_by(storm, plan, river) %>%
    summarise(inun_t_avg = mean(ti_tot_min)/60,#removal_k10_g = sum(k10_removal_g),
            removal_km_g = sum(km_removal_g),
            #removal_k90_g = sum(k90_removal_g),
            inun_A = sum(area_ft2, na.rm = TRUE)) %>%
  mutate(percentRest = case_when(endsWith(plan, "100p")~ 100,
                                 endsWith(plan, "80p")~ 80,
                                 endsWith(plan, "60p")~ 60,
                                 endsWith(plan, "40p")~ 40,
                                 endsWith(plan, "20p")~ 20,
                                 endsWith(plan, "unr")~ 0))
Ainun_3rdO <- Ainun_3rdO %>% 
  mutate(scale_inun_A = 
           case_when(river == "1-7" ~ inun_A*24*0.092903/100000,#I scale loads and areas to the watershed here
                     river == "2-2" ~ inun_A*6*0.092903/100000,
                     river == "3-1" ~ inun_A*2*0.092903/100000,
                     river == "4-1" ~ inun_A*0.092903/100000),
         scaleRemoval_km_kg = 
           case_when(river == "1-7" ~ removal_km_g*24/1000,
                     river == "2-2" ~ removal_km_g*6/1000,
                     river == "3-1" ~ removal_km_g*2/1000,
                     river == "4-1" ~ removal_km_g/1000),
         order = 
           case_when(river == "1-7" ~ "1st-order",
                     river == "2-2" ~ "2nd-order",
                     river == "3-1" ~ "3rd-order",
                     river == "4-1" ~ "4th-order")) 

Ainun_4thO <- inun_4thO %>%
  filter(ti_tot_min > 0)%>%
  mutate(
    FP_width =
           case_when(
             river == "1-7" ~ 16.5,
             river == "2-2" ~ 34.5,
             river == "3-1" ~ 67.5,
             plan == "unr" & river == "4-1" ~ 126,
             plan == "4th-20p" & river == "4-1" & STA >= 80800 ~ 130,
             plan == "4th-20p" & river == "4-1" & STA < 80800 ~ 126,
             plan == "4th-40p" & river == "4-1" & STA >= 60600 ~ 130,
             plan == "4th-40p" & river == "4-1" & STA < 60600 ~ 126,
             plan == "4th-60p" & river == "4-1" & STA >= 40400 ~ 130,
             plan == "4th-60p" & river == "4-1" & STA < 40400 ~ 126,
             plan == "4th-80p" & river == "4-1" & STA >= 20200 ~ 130,
             plan == "4th-80p" & river == "4-1" & STA < 20200 ~ 126,
             plan == "4th-100p" & river == "4-1" ~ 130),
    length_ft =
           case_when(ti_tot_min > 1 ~ 50),
    area_ft2 = FP_width*length_ft) %>%
  # mutate(
  #   k10_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                   ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "4-1" & (STA < 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000)) %>%
   mutate(
    km_removal_g =
      case_when(river == "1-7" & STA %in% c(165500,159500)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "1-7" & STA < 165500 & STA > 159500
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "2-2" & (STA < 159500 & STA > 154000) |
                                 (STA < 154000 & STA > 148500) |
                                 (STA < 148500 & STA > 143000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "3-1" & STA %in% c(143000, 122000, 101000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "3-1" & (STA < 143000 & STA > 122000) |
                                 (STA < 122000 & STA > 101000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "4-1" & STA %in% c(101000, 0)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "4-1" & (STA < 101000 & STA > 0)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000)) %>%
  # mutate(
  #   k90_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "4-1" & (STA < 101000 & STA > 0)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000)) %>%
    group_by(storm, plan, river) %>%
    summarise(inun_t_avg = mean(ti_tot_min)/60,#removal_k10_g = sum(k10_removal_g),
            removal_km_g = sum(km_removal_g),
            #removal_k90_g = sum(k90_removal_g),
            inun_A = sum(area_ft2, na.rm = TRUE)) %>%
  mutate(percentRest = case_when(endsWith(plan, "100p")~ 100,
                                 endsWith(plan, "80p")~ 80,
                                 endsWith(plan, "60p")~ 60,
                                 endsWith(plan, "40p")~ 40,
                                 endsWith(plan, "20p")~ 20,
                                 endsWith(plan, "unr")~ 0))
Ainun_4thO <- Ainun_4thO%>% 
  mutate(scale_inun_A = #I scale loads and areas to the watershed here
           case_when(river == "1-7" ~ inun_A*24*0.092903/100000,#ft^2 to m^2 and divide out the 10^5 to make axis numbers smaller.
                     river == "2-2" ~ inun_A*6*0.092903/100000,
                     river == "3-1" ~ inun_A*2*0.092903/100000,
                     river == "4-1" ~ inun_A*0.092903/100000),
         scaleRemoval_km_kg = 
           case_when(river == "1-7" ~ removal_km_g*24/1000,
                     river == "2-2" ~ removal_km_g*6/1000,
                     river == "3-1" ~ removal_km_g*2/1000,
                     river == "4-1" ~ removal_km_g/1000),
         order = 
           case_when(river == "1-7" ~ "1st-order",
                     river == "2-2" ~ "2nd-order",
                     river == "3-1" ~ "3rd-order",
                     river == "4-1" ~ "4th-order"))

Ainun_1stO$storm <- factor(Ainun_1stO$storm,                 # Re-level group factor
                         levels = c("Q2", "Q1", "Q0.5", "Qm"))
Ainun_2ndO$storm <- factor(Ainun_2ndO$storm,                 # Re-level group factor
                         levels = c("Q2", "Q1", "Q0.5", "Qm"))
Ainun_3rdO$storm <- factor(Ainun_3rdO$storm,                 # Re-level group factor
                         levels = c("Q2", "Q1", "Q0.5", "Qm"))
Ainun_4thO$storm <- factor(Ainun_4thO$storm,                 # Re-level group factor
                         levels = c("Q2", "Q1", "Q0.5", "Qm"))

```

#plot: how total removal changes in the river as area inundated is increased
```{r plot-wider, fig.width=16, fig.height=4}
AvsL_1st <- inun_1stO%>%
  filter(plan == "1st-100p")%>%
  ggplot()+
  geom_point(aes(inun_A, removal_km_kg, color = storm, shape = order))+
  xlab(element_blank())+
  ylab(expression("NO"[3]*" Load Removed (kg)"))+
  ggtitle(expression(atop("100% restored 1"^st*"-order rivers")))

AvsL_2nd <- inun_2ndO%>%
  filter(plan == "2nd-100p")%>%
  ggplot()+
  geom_point(aes(inun_A, removal_km_kg, color = storm, shape = order))+
  xlab(element_blank())+
  ylab(element_blank())+
  ggtitle(expression(atop("100% restored 2"^nd*"-order rivers")))

AvsL_3rd <- inun_3rdO%>%
  filter(plan == "3rd-100p")%>%
  ggplot()+
  geom_point(aes(inun_A, removal_km_kg, color = storm, shape = order))+
  xlab(element_blank())+
  ylab(element_blank())+
  ggtitle(expression(atop("100% restored 3"^rd*"-order rivers")))

AvsL_4th <- inun_4thO%>%
  filter(plan == "4th-100p")%>%
  ggplot()+
  geom_point(aes(inun_A, removal_km_kg, color = storm, shape = order))+
  xlab(element_blank())+
  ylab(element_blank())+
  ggtitle(expression(atop("100% restored 4"^th*"-order rivers")))

 AvsL_1st + AvsL_2nd + AvsL_3rd + AvsL_4th + 
  plot_layout(ncol = 4, guides = "collect")+
  plot_annotation(title = expression(atop("NO"[3]*" Load Removed vs Inundated Area (k"[m]*" rate)")),
                  caption = expression("Inundated Area (m"^2*")"),
                  tag_levels = 'A',
                  theme = theme(title = element_text(size = 12, face = 2), plot.caption = element_text(hjust = 0.5))) &
  theme(text = element_text(size = 10)) &
   scale_x_continuous(labels = scales::scientific)

ggsave("Figures/Avsremoval_km_only100p.png", dpi=500, width = 16, height = 4, units="in")
```

```{r}
bind_rows(Ainun_1stO, Ainun_2ndO, Ainun_3rdO, Ainun_4thO)%>%
  mutate(restLoc = 
           case_when(startsWith(plan, "unr") ~ "unr",
                     startsWith(plan, "1st") ~ "1st",
                     startsWith(plan, "2nd") ~ "2nd",
                     startsWith(plan, "3rd") ~ "3rd",
                     startsWith(plan, "4th") ~ "4th"))%>%
  mutate(order = 
           case_when(river == "1-7" ~ "1st-order rivers",
                     river == "2-2" ~ "2nd-order rivers",
                     river == "3-1" ~ "3rd-order rivers",
                     river == "4-1" ~ "4th-order river"))%>%
   mutate(restLoc = 
           case_when(startsWith(plan, "unr") ~ "unr",
                     startsWith(plan, "1st") ~ "1st",
                     startsWith(plan, "2nd") ~ "2nd",
                     startsWith(plan, "3rd") ~ "3rd",
                     startsWith(plan, "4th") ~ "4th"))%>%
  # filter(order ==  "1st-order rivers" | order ==  "2nd-order rivers")%>%
  # filter(order ==  "3rd-order rivers" | order ==  "4th-order river")%>%
  # filter(restLoc == "1st" | restLoc == "2nd")%>%
  ggplot()+
  geom_point(aes(scale_inun_A, scaleRemoval_km_kg, color = storm, shape= order), size = 1)+
  ylim(0,30)+
  xlab((expression(atop("Inundated Floodplain Area (x10"^5*" m"^2*")"))))+
  ylab(expression("NO"[3]*" Load Removed (kg)"))+
  labs(color = "Storm", shape = "Areal Location")+
  ggtitle(expression(atop("Inundated Area vs Nitrate Load Removed (k"[m]*" rate)")))+
  plot_annotation(theme = theme(title = element_text(size = 12, face = 2))) &
  theme(text = element_text(size = 10))

ggsave("Figures/Avsremoval_km.png", dpi=500, width = 7, height = 4, units="in")
```


#Plot: total inundated FP area
```{r plot-wider, fig.width=13, fig.height=4}
Ainun_1st <- inun_1stO %>%
  filter(river =="1-7")%>%
  ggplot()+
  geom_point(aes(percentRest, inun_A, color=storm))+
  geom_line(aes(percentRest, inun_A, color=storm))+
  scale_x_continuous(breaks=seq(0,100,by=20))+
  # ylim(0,800000)+
  # scale_y_continuous(labels = scales::scientific)+
  xlab(expression(atop("Percent of 1"^st*"-Order Rivers Restored")))+
  ylab(expression(atop("Inundated Floodplain Area (x10"^5*" m"^2*")")))+
  ggtitle(expression("All 1"^st*"-order Rivers"))

Ainun_2nd <- inun_2ndO %>%
  filter(river =="2-2")%>%
  ggplot()+
  geom_point(aes(percentRest, inun_A, color=storm))+
  geom_line(aes(percentRest, inun_A, color=storm))+
  scale_x_continuous(breaks=seq(0,100,by=20))+ 
  # scale_y_continuous(labels = scales::scientific)+
  xlab(expression(atop("Percent of 2"^nd*"-Order Rivers Restored")))+
  ylab(element_blank())+
  ggtitle(expression("All 2"^nd*"-order Rivers"))

Ainun_3rd <- inun_3rdO %>%
  filter(river =="3-1")%>%
  ggplot()+
  geom_point(aes(percentRest, inun_A, color=storm))+
  geom_line(aes(percentRest, inun_A, color=storm))+
  scale_x_continuous(breaks=seq(0,100,by=20))+ 
  # scale_y_continuous(labels = scales::scientific)+
  xlab(expression(atop("Percent of 3"^rd*"-Order Rivers Restored")))+
  ylab(element_blank())+
  ggtitle(expression("All 3"^rd*"-order Rivers"))

Ainun_4th <- inun_4thO %>%
  filter(river == "4-1")%>%
  ggplot()+
  geom_point(aes(percentRest, inun_A, color=storm))+
  geom_line(aes(percentRest, inun_A, color=storm))+
  scale_x_continuous(breaks=seq(0,100,by=20))+ 
  # scale_y_continuous(labels = scales::scientific)+
  xlab(expression(atop("Percent of the 4"^th*"-Order River Restored")))+
  ylab(element_blank())+
  ggtitle(expression("All 4"^th*"-order Rivers"))

Ainun_1st + Ainun_2nd + Ainun_3rd + Ainun_4th + 
  plot_layout(ncol = 4, guides = "collect")+
  plot_annotation(title = expression(atop("Total Inundated Floodplain Area")),
                  tag_levels = 'A',
                  theme = theme(title = element_text(size = 12, face = 2), plot.caption = element_text(hjust = 0.5))) &
  theme(text = element_text(size = 10))

ggsave("Figures/tot_inun_A.png", dpi=500, height = 4, width = 13, units="in")
```


#Full restoration area DF
```{r}
#load "Full_InunTimes.Rdata"
Ainun_Full <- NO3_Full %>%
  # filter(ti_tot_min > 0)%>%
   mutate(length_ft = 50,
          area_ft2 = case_when(ti_tot_min>0 ~ FP_width*length_ft,
                        TRUE~ 0)) %>%
  # mutate(
  #   k10_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                   ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                   ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  # 
  #               river == "4-1" & (STA < 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k10/1000,
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k10/1000)) %>%
   mutate(
    km_removal_g =
      case_when(river == "1-7" & STA %in% c(165500,159500)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "1-7" & STA < 165500 & STA > 159500
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "2-2" & (STA < 159500 & STA > 154000) |
                                 (STA < 154000 & STA > 148500) |
                                 (STA < 148500 & STA > 143000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "3-1" & STA %in% c(143000, 122000, 101000)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "3-1" & (STA < 143000 & STA > 122000) |
                                 (STA < 122000 & STA > 101000)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000,

                river == "4-1" & STA %in% c(101000, 0)
                                      ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*km/1000,
                river == "4-1" & (STA < 101000 & STA > 0)
                                      ~ (ti_tot_min/60)*Xcs*(FP_width*2)*km/1000)) %>%
  # mutate(
  #   k90_removal_g =
  #     case_when(river == "1-7" & STA %in% c(165500,159500)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "1-7" & STA < 165500 & STA > 159500
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "2-2" & STA %in% c(159500, 154000, 148500, 143000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "2-2" & (STA < 159500 & STA > 154000) |
  #                                (STA < 154000 & STA > 148500) |
  #                                (STA < 148500 & STA > 143000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "3-1" & STA %in% c(143000, 122000, 101000)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "3-1" & (STA < 143000 & STA > 122000) |
  #                                (STA < 122000 & STA > 101000)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000,
  # 
  #               river == "4-1" & STA %in% c(101000, 0)
  #                                     ~ (ti_tot_min/60)*(Xcs/2)*(FP_width*2)*k90/1000,
  #               river == "4-1" & (STA < 101000 & STA > 0)
  #                                     ~ (ti_tot_min/60)*Xcs*(FP_width*2)*k90/1000)) %>%
    mutate(scale_inun_A_km2 = #I scale loads and areas to the watershed here
           case_when(river == "1-7" ~ area_ft2*24*0.092903/1000000,
                     river == "2-2" ~ area_ft2*6*0.092903/1000000,
                     river == "3-1" ~ area_ft2*2*0.092903/1000000,
                     river == "4-1" ~ area_ft2*0.092903/1000000),
         scaleRemoval_km_kg = 
           case_when(river == "1-7" ~ km_removal_g*24/1000,
                     river == "2-2" ~ km_removal_g*6/1000,
                     river == "3-1" ~ km_removal_g*2/1000,
                     river == "4-1" ~ km_removal_g/1000))%>%
    group_by(storm, plan) %>%
    summarise(#removal_k10_g = sum(k10_removal_g),
            shedRemoval_km_kg = sum(scaleRemoval_km_kg, na.rm = TRUE),
            #removal_k90_g = sum(k90_removal_g),
            shedInun_A = sum(scale_inun_A_km2, na.rm = TRUE))%>% 
  mutate(PerShedRest = case_when(plan == "unr" ~ 0,
                                 plan == "1st-20p" ~ 7, 
                                 plan == "1st-40p" ~ 13,
                                 plan == "1st-60p" ~ 20,
                                 plan == "1st-80p" ~ 27,
                                 plan == "1st-100p" ~ 34,
                                 plan == "2nd-20p" ~ 38,
                                 plan == "2nd-60p" ~ 48,
                                 plan == "2nd-80p" ~ 52,
                                 plan == "2nd-100p" ~ 57,
                                 plan == "3rd-20p" ~ 61,
                                 plan == "3rd-40p" ~ 65,
                                 plan == "3rd-60p" ~ 69,
                                 plan == "3rd-80p" ~ 72,
                                 plan == "3rd-100p" ~ 76,
                                 plan == "4th-20p" ~ 81,
                                 plan == "4th-40p" ~ 86,
                                 plan == "4th-60p" ~ 91,
                                 plan == "4th-80p" ~ 95,
                                 plan == "4th-100p" ~ 100))%>%
  mutate(plan = case_when(startsWith(plan, "full") ~ substring(plan,
                                                               first = 6,
                                                               last = nchar(plan)),
                                                               TRUE ~ plan),
         restLoc = 
           case_when(startsWith(plan, "unr") ~ "1st-order rivers",
                     startsWith(plan, "1st") ~ "1st-order rivers",
                     startsWith(plan, "2nd") ~ "2nd-order rivers",
                     startsWith(plan, "3rd") ~ "3rd-order rivers",
                     startsWith(plan, "4th") ~ "4th-order river"))


```


```{r plot-wider, fig.width=6, fig.height=4}
Ainun_Full$storm <- factor(Ainun_Full$storm,                 # Re-level group factor
                         levels = c("Q2", "Q1", "Q0.5", "Qm"))
Ainun_Full %>%
  ggplot()+
  geom_point(aes(PerShedRest, shedInun_A, color=storm, shape = restLoc), size = 1)+
  geom_line(aes(PerShedRest, shedInun_A, color=storm), linewidth = 0.5)+
  labs(x = expression(atop("Percent of the 4"^th*"-order Watershed Restored")), 
       y = expression("Inundated Area (km"^2*")"), 
       color = "Storm",
       shape = expression(atop("Location Cumulatively", "Restored Through")))+
  scale_x_continuous(breaks=seq(0,100,by=20),  
                     sec.axis = sec_axis(~.*130.454/100, 
                                         name = "Watershed Length Restored [km]", 
                                         breaks = seq(0,135,10)))+
  ggtitle(expression(atop("Inundated Floodplain Area in the 4"^th*"-order Watershed Due to Full Restoration")))+
  theme(text = element_text(size = 8), 
        title = element_text(size = 8),
        legend.title = element_text(size=6),
        legend.text = element_text(size=6))
ggsave("Figures/Full_inunA.png", dpi=500, width = 6, height = 4, units="in")
```

#A vs load removed summed over the full watershed and by river
```{r plot-wider, fig.width=6, fig.height=4}
inunAnT_Full$river <- factor(inunAnT_Full$river,                 # Re-level group factor
                         levels = c("1-7", "2-2", "3-1", "4-1"))
inunAnT_Full$storm <- factor(inunAnT_Full$storm,                 # Re-level group factor
                         levels = c("Q2", "Q1", "Q0.5", "Qm"))
inunAnT_Full%>%
  # filter(order ==  "1st-order rivers" | order ==  "2nd-order rivers")%>%
  filter(order ==  "3rd-order rivers" | order ==  "4th-order river")%>%
  ggplot()+
  geom_point(aes(scale_inunA_m2, scaleRemoval_km_kg, color = storm, shape= order), size = 1)+
  # ylim(0,30)+
  xlab((expression(atop("Inundated Floodplain Area (x10"^5*" m"^2*")"))))+
  ylab(expression("NO"[3]*" Load Removed (kg)"))+
  labs(color = "Storm", shape = "Areal Location")+
  ggtitle(expression(atop("Inundated Area vs Nitrate Load Removed Due to Full Restoration (k"[m]*" rate)")))+
  theme(text = element_text(size = 8), 
        title = element_text(size = 8),
        legend.title = element_text(size=6),
        legend.text = element_text(size=6))
ggsave("Figures/Full_Avsremoval_3rd&4th_km.png", dpi=500, width = 6, height = 4, units="in")
```

